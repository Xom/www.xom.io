(()=>{"use strict";class t{constructor(t,e){this.x=t,this.y=e}dist(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}}class e{constructor(t,e,n,s,l){this.radius=t,this.center=s,this.color=l,this.stAngle=e,this.endAngle=n}draw(t){const{x:e}=this.center,{y:n}=this.center,s=t.getContext("2d");s.beginPath(),s.arc(e,n,this.radius,this.stAngle,this.endAngle),s.lineTo(e,n),s.fillStyle=this.color,s.fill(),s.closePath()}}class n{constructor(e,n,s){this.elements=e,this.colors=n,this.pieces={},this.radius=40,this.canvas=s,this.center=new t(50,50),this.init()}draw(){let t=0,n=0;Object.keys(this.elements).forEach((s=>{var l;n=t+(l=360*this.elements[s],Math.PI/180*l);const a=new e(this.radius,t,n,this.center,this.colors[s]);this.pieces[s]=a,a.draw(this.canvas),t=n})),this.addLabels()}redraw(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),Object.values(this.pieces).forEach((t=>t.draw(this.canvas))),this.addLabels()}getLabelPosition(e){const n=(e.stAngle+e.endAngle)/2,s=-.3*this.radius,l=e.radius+s;return function(e,n,s){const l=n.x+s*Math.cos(e),a=n.y+s*Math.sin(e);return new t(l,a)}(n,e.center,l)}addLabels(){const t=this.canvas.getContext("2d");t.font="bold 10px sans-serif",Object.entries(this.pieces).forEach((e=>{const[n,s]=e,l=this.getLabelPosition(s);t.fillStyle="white";const a=`${n} (${Math.round(100*this.elements[n])}%)`;t.fillText(a,l.x,l.y)}))}init(){}}const s={21:"#0044FF",20:"#007A00",19:"#339933",18:"#66AA55",17:"#99BB77",X:"#CC0000"},l=8192,a=8191,c=[0,21,20,19,18,17],o=["X","21","20","19","18","17"],i=t=>t&&t<=21?22-t:0,r=(t,e)=>!(t&1<<e),d=t=>t&&t<10?t:10,h=new Array(l*c.length),m=new Array(67108864);for(let t=0;t<h.length;t++)h[t]=0;for(let t=0;t<m.length;t++)m[t]=0;const u=(t,e,n,s,o,r)=>{const p=e/n.length;for(let e=0;e<n.length;e++){const g=n[e],f=o+d(g),w=r||1===g,C=w&&f<=11?f+10:f;if(C>=17)if(h[t*c.length+i(C)]+=p,1===n.length)m[t*l]+=p;else{let s=a;for(let t=0;t<n.length;t++)e!==t&&(s-=1<<n[t]);m[t*l+s]+=p}else if(1===n.length)u(t,p,s,[],f,w);else{const l=[];for(let t=0;t<n.length;t++)e!==t&&l.push(n[t]);u(t,p,l,s,f,w)}}},p=(t,e,n,s,l,c,o,r)=>{if(null===e){const e=t[i(o?c+10:c)];if(e.mass+=n,0===s.length)e.transitions[0]+=n;else{let t=a;for(let e=0;e<s.length;e++)t-=1<<s[e];e.transitions[t]+=n}return}const h=n/s.length;for(let n=0;n<s.length;n++){const m=s[n],u=-1===r?m:r,g=c+d(m),f=o||1===m,w=f&&g<=11?g+10:g;if(w>=17){const l=t[i(w)],c=e[u];if(l.mass+=h,c.mass+=h,c.outcomes[i(w)]+=h,1===s.length)l.transitions[0]+=h,c.transitions[0]+=h;else{let t=a;for(let e=0;e<s.length;e++)n!==e&&(t-=1<<s[e]);l.transitions[t]+=h,c.transitions[t]+=h}}else if(1===s.length)p(t,e,h,l,[],g,f,u);else{const a=[];for(let t=0;t<s.length;t++)n!==t&&a.push(s[t]);p(t,e,h,a,l,g,f,u)}}},g=(t,e)=>{const n=new Array(c.length),s={};for(let l=0;l<c.length;l++){n[l]=0;for(let e=0;e<a;e++)n[l]+=t[e]*h[e*c.length+l];s[o[l]]=n[l]/e}return[s]},f=["A","2","3","4","5","6","7","8","9","T","J","Q","K","0"],w=["draw","table","discard"],C=[12,0,1,2,3,4,5,6,7,8,9,10,11],E=[1,2,3,4,5,6,7,8,9,10,11,12,0],y={};f.forEach(((t,e)=>y[e]="draw"));const x=t=>{let e=0,n=!1;for(let t=0;t<f.length;t++)"table"===y[t]&&(0===t?(n=!0,e+=1):t<10?e+=t+1:13!==t&&(e+=10));return t&&n&&e<=11&&(e+=10),e};function A(t){if(w.forEach((t=>{for(let e=0;e<f.length;e++){const n=document.querySelector(`td[data-row="${t}"][data-card="${e}"]`),s=y[e]===t,l=f[e];if(n.innerHTML="",s)n.textContent=l,n.classList.remove("empty-cell");else{const t=document.createElement("span");t.className="preview",t.textContent=l,n.appendChild(t),n.classList.add("empty-cell")}}})),t)return(()=>{const t=x(!0);return document.getElementById("currentScore").textContent=t,t})()}const b=()=>{const t=A(!0),e=new Array(c.length);for(let t=0;t<c.length;t++){const n=new Array(a);for(let t=0;t<a;t++)n[t]=0;e[t]={mass:0,transitions:n}}const l=[],i=[];for(let t=0;t<13;t++)switch(y[C[t]]){case"draw":l.push(t);break;case"discard":i.push(t)}const r=0===l.length,h=x(!1),m="table"===y[0],u=t>=17?null:new Array(13);if(null===u)r?p(e,null,1,i,[],h,m):p(e,null,1,l,i,h,m);else{for(let t=0;t<13;t++){const e=new Array(a);for(let t=0;t<a;t++)e[t]=0;const n=new Array(c.length);for(let t=0;t<c.length;t++)n[t]=0;u[t]={mass:0,transitions:e,outcomes:n}}r?p(e,u,1,i,[],h,m,-1):p(e,u,1,l,i,h,m,-1)}const w=[],b=new Array(a);for(let t=0;t<a;t++)b[t]=0;for(let t=0;t<c.length;t++){const n=e[t].transitions;for(let t=0;t<a;t++)b[t]+=n[t]}const v=g(b,1),L=document.createElement("tr"),B=document.createElement("td");B.textContent="Any",L.appendChild(B);const I=document.createElement("td");I.className="pie-cell";const N=document.createElement("canvas");N.width=120,N.height=100;const T={};for(let t=0;t<c.length;t++)T[o[t]]=e[t].mass;new n(T,s,N).draw(),I.appendChild(N),L.appendChild(I);for(let t=0;t<1;t++){const e=document.createElement("td");e.className="pie-cell";const l=document.createElement("canvas");l.width=120,l.height=100,new n(v[t],s,l).draw(),e.appendChild(l),L.appendChild(e)}w.push(L);for(let t=0;t<c.length;t++){const l=e[t];if(l.mass>0){const e=document.createElement("tr"),a=document.createElement("td");a.textContent=0===t?"Bust":o[t],e.appendChild(a);const c=document.createElement("td");c.textContent=`${(100*l.mass).toFixed(1)}%`,e.appendChild(c);const i=g(l.transitions,l.mass);for(let t=0;t<1;t++){const l=document.createElement("td");l.className="pie-cell";const a=document.createElement("canvas");a.width=120,a.height=100,new n(i[t],s,a).draw(),l.appendChild(a),e.appendChild(l)}w.push(e)}}document.getElementById("outcomeRows").replaceChildren(...w);const M=[],P=document.createElement("tr"),S=document.createElement("td");S.textContent=null===u?"Stand":"Any",P.appendChild(S);const $=document.createElement("td");$.className="pie-cell";const k=document.createElement("canvas");k.width=120,k.height=100,new n(T,s,k).draw(),$.appendChild(k),P.appendChild($);for(let t=0;t<1;t++){const e=document.createElement("td");e.className="pie-cell";const l=document.createElement("canvas");l.width=120,l.height=100,new n(v[t],s,l).draw(),e.appendChild(l),P.appendChild(e)}if(M.push(P),null!==u){const t=r?"discard":"draw";r?i.length:l.length;let e=null;for(let l=0;l<14;l++){if(y[l]!==t)continue;const a=l<13&&10===d(E[l]);if(a&&null!==e){e.textContent+=f[l];continue}const i=document.createElement("tr"),r=document.createElement("td");if(r.textContent=f[l],i.appendChild(r),13===l){const t=document.createElement("td");t.textContent='same as "Any"',t.colSpan=2,i.appendChild(t),M.push(i);continue}a&&(e=r);const h=u[E[l]],m=document.createElement("td");m.className="pie-cell";const p=document.createElement("canvas");p.width=120,p.height=100;const w={};for(let t=0;t<c.length;t++)w[o[t]]=h.outcomes[t]/h.mass;new n(w,s,p).draw(),m.appendChild(p),i.appendChild(m);const C=g(h.transitions,h.mass);for(let t=0;t<1;t++){const e=document.createElement("td");e.className="pie-cell";const l=document.createElement("canvas");l.width=120,l.height=100,new n(C[t],s,l).draw(),e.appendChild(l),i.appendChild(e)}M.push(i)}}document.getElementById("nextCardRows").replaceChildren(...M)},v=document.getElementById("initBtn");v.addEventListener("click",(()=>{v.disabled=!0,v.textContent="Initializing...",setTimeout((()=>{(()=>{for(let t=0;t<a;t++){const e=[],n=[];for(let s=0;s<13;s++)(r(t,s)?e:n).push(s);u(t,1,e,n,0,!1)}})(),v.textContent="Initialized.",document.getElementById("gamestateTable").classList.remove("disabled"),b()}),10)})),function(){const t=document.getElementById("gamestateRows");w.forEach((e=>{const n=document.createElement("tr"),s=document.createElement("th");s.textContent="draw"===e?"Draw Pile":"table"===e?"Table":"Discard",n.appendChild(s);for(let t=0;t<f.length;t++){const s=document.createElement("td");s.dataset.row=e,s.dataset.card=t,s.className="card-cell",s.addEventListener("click",(()=>{document.getElementById("gamestateTable").classList.contains("disabled")||(y[t]=e,b())})),n.appendChild(s)}t.appendChild(n)})),A(!1)}()})();
//# sourceMappingURL=bundle.js.map